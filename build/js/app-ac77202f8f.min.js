angular.module("app.Config",[]).constant("Config",{serverurl:"http://localhost:8808"}),angular.module("templates",[]),angular.module("app",["ngRoute","ui.router","controllerModule","directiveModule","filterModule","app.Config","templates"]).config(["$routeProvider","$httpProvider","$stateProvider","$urlRouterProvider",function(t,e,n,i){n.state("weather",{url:"/weather",templateUrl:"views/weather.html",controller:"weatherController"}).state("news",{url:"/news",templateUrl:"views/news.html",controller:"newsController"}),i.when("","/weather").otherwise("/weather")}]),angular.module("controllerModule",["serviceModule"]).controller("weatherController",["$scope","weatherService","$filter","$timeout",function(t,e,n,i){t.weatherService=e,t.data={},t.searchWeather=function(){t.data.placename=t.data.placename||e.cityname,t.weatherService.requestWeatherResource(t.data.placename).then(function(){t.data.errmsg=null,t.weatherService.cityname=t.data.placename,t.weatherService.weatherResult.iconid=n("weathericon")(t.weatherService.weatherResult.realtime.weather.info)},function(e){t.data.errmsg="暂未收录该城市的天气状况",i(function(){t.data.errmsg=null},5e3)})},t.searchWeather()}]).controller("newsController",["$scope","newsService",function(t,e){t.newsService=e,t.newsService.requestNewsResource().then(function(){},function(t){console.warn(t)}),t.loadMore=function(){t.newsService.loadMore().then(function(){},function(t){})}}]),angular.module("templates").run(["$templateCache",function(t){t.put("template/news.html",'<div>\n\t<!-- 旅游新闻 -->\n\n\t<div class="news" style="border: 1px solid ;" ng-repeat="item in result track by $index">\n\t\t<a ng-click="open(item.url)">\n\t\t\t<div class="container">\n\t\t\t\t<div class="thumbnail" style="display: inline-block;">\n\t\t\t\t\t<img ng-src="{{item.picUrl}}" />\n\t\t\t\t</div>\n\t\t\t\t<div class="content" style="display: inline-block; vertical-align: top;">\n\t\t\t\t\t<div class="title" ng-bind="item.title">\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="desc" ng-bind="item.description">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</a>\n\t</div>\n</div>'),t.put("template/weather.html",'<div>\n\t<!-- 天气模板 -->\n\t<div class="weather">\n\t\t<h1 ng-bind="result.realtime.city_name">南京</h1>\n\t\t<div class="weather-title">\n\t\t\t\t<span>农历</span><span ng-bind="result.realtime.moon"></span>&nbsp;\n\t\t\t\t<span>周</span><span ng-bind="result.weather[0].week"></span>\n\t\t\t<div>\n\t\t\t\t<span ng-bind="result.realtime.date">2017-09-23</span>&nbsp;\n\t\t\t\t<span ng-bind="result.realtime.time"></span>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<!-- <span>湿度:</span> <span ng-bind="result.realtime.weather.humidity"></span> -->\n\t\t\t</div>\n\t\t</div>\n\t\t<div>\n\t\t\t<div  style="display: inline-block; vertical-align: top; text-align: center; width: 5.2rem;">\n\t\t\t\t<i id="weather" class="{{result.iconid}}" style="font-size: 1rem;"></i>\n\t\t\t\t<div class="weather" style="text-align: center; margin-top: 0.1rem;">\n\t\t\t\t\t<span ng-bind="result.realtime.weather.temperature"></span><i class="icon-Celsius" style="font-size: 0.3rem;"></i>\n\t\t\t\t\t<span ng-bind="result.realtime.weather.info" style="display: block;"></span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div class="wind">\n\t\t\t\t\t<span ng-bind="result.realtime.wind.windspeed"></span>\n\t\t\t\t\t<span ng-bind="result.realtime.wind.direct"></span>\n\t\t\t\t\t<span ng-bind="result.realtime.wind.power"></span>\n\t\t\t\t</div>\t\t\t\t\n\t\t\t</div>\n\t\t\t<div class="weather-pm">\n\t\t\t\t<h1>PM2.5</h1>\n\t\t\t\t<span style="display: block;">空气质量:<span ng-bind="result.pm25.pm25.quality"></span></span>\n\t\t\t\t<span style="display: block;"><span ng-bind="result.pm25.pm25.des"></span></span>\t\n\t\t\t\t<span style="display: block;">PM: <span ng-bind="result.pm25.pm25.curPm"></span></span>\t\n\t\t\t\t<span style="display: block;">PM2.5: <span ng-bind="result.pm25.pm25.pm25"></span></span>\t\n\t\t\t\t<span style="display: block;">PM10: <span ng-bind="result.pm25.pm25.pm10"></span></span>\t\n\t\t\t</div>\t\t\n\t\t</div>\n\t\t<div class="weather-life">\n\t\t\t<h1>生活指数</h1>\n\t\t\t<span style="display:block;" ng-bind="result.realtime.weather.date"></span>\n\t\t\t<div ng-repeat="(key, value) in result.life.info track by key">\n\t\t\t\t<div ng-if="value">\n\t\t\t\t\t<span ng-bind="key | formatlife"></span>&nbsp;<span>:</span>\n\t\t\t\t\t<span ng-bind="value[0]" class="normal"></span>\n\t\t\t\t\t<span ng-bind="value[1]" class="warning" style="display: block;"></span>\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>')}]),angular.module("directiveModule",[]).directive("weatherDirective",[function(){return{restrict:"E",scope:{result:"=",weatherIcon:"&"},templateUrl:"template/weather.html"}}]).directive("newsDirective",[function(){return{restrict:"E",scope:{result:"=",loadMore:"&"},templateUrl:"template/news.html",link:function(t){t.open=function(t){window.open(t,"_blank")}}}}]),angular.module("filterModule",[]).filter("formatlife",function(){return function(t){var e=t;return angular.forEach(filterItem.lifeinfo,function(n,i){t==n.id&&(e=n.text)}),e}}).filter("weathericon",function(){return function(t){var e="";return angular.forEach(filterItem.weatherIcon,function(n,i){n.text==t&&(e=n.icon_id)}),e}});var filterItem=filterItem||{},lifeinfo=[{id:"chuxing",text:"出行"},{id:"wuran",text:"污染"},{id:"kongtiao",text:"空调"},{id:"yundong",text:"运动"},{id:"ziwaixian",text:"紫外线"},{id:"ganmao",text:"感冒"},{id:"xiche",text:"洗车"},{id:"chuanyi",text:"穿衣"}],weatherIcon=[{icon_id:"icon-sun",text:"晴"},{icon_id:"icon-lightning3",text:"雷阵雨"},{icon_id:"icon-rainy2",text:"大雨"},{icon_id:"icon-rainy",text:"小雨"},{icon_id:"icon-cloud5",text:"阴"},{icon_id:"icon-snowy",text:"雪"},{icon_id:"icon-snowy2",text:"小雪"},{icon_id:"icon-snowy3",text:"大雪"},{icon_id:"icon-weather4",text:"暴雨"},{icon_id:"icon-snowy3",text:"雨夹雪"},{icon_id:"icon-lightning5",text:"阵雨"}];filterItem={lifeinfo:lifeinfo,weatherIcon:weatherIcon},angular.module("serviceModule",[]).service("weatherService",["$http","$q","Config",function(t,e,n){var i={weatherResult:null,requestWeatherResource:function(r){r&&r.length<1&&(r=null);var a=e.defer();return t({method:"get",url:n.serverurl+"/weather",params:{cityname:r}}).then(function(t){0===t.data.error_code?(i.weatherResult=t.data.result,a.resolve()):a.reject(t)},function(t){a.reject(t)}),a.promise}};return i}]).service("newsService",["$http","$q","Config",function(t,e,n){var i={newsResult:null,page:1,rows:10,isLoadMore:!1,hasMore:!0,requestLocalNews:function(){var n=e.defer();return t({method:"get",url:"./js/news.json"}).then(function(t){n.resolve(t)},function(t){console.log(t)}),n.promise},requestNewsResource:function(){var r=e.defer();return t({method:"get",url:n.serverurl+"/news",params:{page:i.page,rows:i.rows}}).then(function(t){0===t.data.error_code?(t.data.result?i.newsResult=i.isLoadMore?i.newsResult.concat(t.data.result):t.data.result:(i.hasMore=!1,i.newsResult||i.requestLocalNews().then(function(t){i.newsResult=t.data.result,r.resolve()},function(){r.reject("获取数据失败")})),r.resolve()):r.reject(),i.isLoadMore=!1},function(t){r.reject()}),r.promise},loadMore:function(){i.isLoadMore=!0,i.page++;var t=e.defer();return i.requestNewsResource().then(function(){t.resolve()},function(e){t.reject(e)}),t.promise}};return i}]),angular.module("templates").run(["$templateCache",function(t){t.put("views/home.html",'<h1>\n\tHome\n\n\t<section>\n\t\t<input type="text" ng-model="data.name" placeholder="write text, please" name="">\n\t\t<div>\n\t\t\t{{data.hk}}\n\t\t</div>\n\t</section>\n\t\n</h1>'),t.put("views/news.html",'<h1>新闻</h1>\n\n<news-directive result="newsService.newsResult"></news-directive>\n\n\t<div align="center">\n\t\t<div ng-click="loadMore()" ng-if="newsService.newsResult.length > 9 && newsService.hasMore" style="width: 50%;  line-height: 0.7rem; text-align: center;">\n\t\t\t加载更多\n\t\t</div>\n\t</div>'),t.put("views/weather.html",'\n<div>\n\t<input type="text" style="border: 1px solid #999;padding: 0.1rem 0.1rem; width: 4rem;" placeholder="请输入城市名字" ng-model="data.placename" />\n\t<span style="display: inline-block; background-color: #aabbcc; padding: 0.08rem 0.08rem;" ng-click="searchWeather()">查询</span>\n\t<div>\n\t\t<span ng-if="data.errmsg" style="color: red;">*</span>\n\t\t<span style="color: red;" ng-bind="data.errmsg"></span>\n\t</div>\n</div>\n<weather-directive ng-if="weatherService.weatherResult" result="weatherService.weatherResult" weather-icon="data"></weather-directive>\n')}]);